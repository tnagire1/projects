import os
import csv
from collections import Counter
import xml.etree.ElementTree as ET
import pandas as pd

features=['android.permission.UPDATE_DEVICE_STATE','jp.united.app.cocoppa.permission.C2D_MESSAGE','com.unearby.sayhi.permission.MAPS_RECEIVE','com.gameloft.android.GAND.kucamgrli.permission.C2D_MESSAGE','com.qihoo.antivirus.update.permission.i18n_security','com.wrc.wordstorm.android.permission.C2D_MESSAGE','com.okcupid.okcupid.permission.C2D_MESSAGE','android.permission.RECEIVE_SMS','com.android.launcher3.permission.READ_SETTINGS','com.tencent.mm.ext.permission.WRITE','com.samsung.wmanager.ENABLE_NOTIFICATION','com.samsung.WATCH_APP_TYPE.Linkage_Slave','com.yahoo.mobile.client.android.finance.permission.C2D_MESSAGE','com.google.android.providers.gsf.permisson.READ_GSERVICES','android.permission.LOCATION','com.yahoo.mobile.client.android.permissions.YAHOO_SPORTACULAR','mobi.abcmouse.academy_goo.permission.C2D_MESSAGE','com.zumobi.msnbc.permission.C2D_MESSAGE','com.tmob.teknosa.share.MSTwitter','android.permission.READ_CALENDAR','com.mw.rouletteroyale.permission.C2D_MESSAGE','de.hafas.android.db.permission.C2D_MESSAGE','com.riverisland.android.C2D_MESSAGE','mnn.Android.permission.C2D_MESSAGE','com.mozillaonline.permission.ACCESS_DOWNLOAD_MANAGER_ADVANCED','com.tencent.mm.permission.C2D_MESSAGE','com.musixmatch.android.lyrify.permission.SCROBBLET_PRIVATE_SERVICE','wp.wattpad.permission.C2D_MESSAGE','com.mozillaonline.permission.SEND_DOWNLOAD_COMPLETED_INTENTS','com.runtastic.android.permission.C2D_MESSAGE','net.daum.android.air.permission.C2D_MESSAGE','android.permission.ACCESS_COURSE_LOCATION','com.tljtek.casino.permission.C2D_MESSAGE','com.weathercreative.weatherkitty.permission.C2D_MESSAGE','com.tencent.mm.permission.MM_MESSAGE','com.yotadevices.framework.permission.ACCESS_BACKSCREEN','com.htc.launcher.permission.WRITE_SETTINGS','android.permission.GET_ACCOUNTS','com.mvine.q.permission.C2D_MESSAGE','com.sololearn.javascript.permission.C2D_MESSAGE','android.permission.PROCESS_OUTGOING_CALLS','android.hardware.sensor.accelerometer','com.withings.wiscale2.permission.C2D_MESSAGE','com.smule.magicpiano.permission.C2D_MESSAGE','com.sonypicturestelevision.sportsjeopardy.permission.UA_DATA','com.tmoney.vending.INBILLING','android.permission.MASTER_CLEAR','com.pocketplay.PW1A.permission.C2D_MESSAGE','com.android.launcher.permission.INSTALL_SHORTCUT','android.permission.ACCESS_FINE_LOCATIION','com.yahoo.mobile.client.android.permissions.YAHOO_INTER_APP','com.android.vending.BILLING','ru.dublgis.dgismobile.permission.C2D_MESSAGE','android.permission.UPDATE_DEVICE_STATS','android.permission.BATTERY_STATS','android.permission.SET_TIME_ZONE','com.scopely.skeeball.permission.C2D_MESSAGE','android.permission.BIND_WALLPAPER','android.permission.INTERACT_ACROSS_USERS_FULL','android.permission.INSTALL_PACKAGES','com.google.android.c2dm.permission.RECEIVE','com.outlook.Z7.permission.CLIENT_PERMISSION','com.riverisland.android.permission.MAPS_RECEIVE','android.permission.HARDWARE_TEST','android.permission.MODIFY_PHONE_STATE','com.outfit7.tomlovesangelafree.permission.C2D_MESSAGE','android.permission.WAKE_LOCK','com.sololearn.htmltrial.permission.C2D_MESSAGE','android.permission.MODIFY_AUDIO_SETTINGS','android.permission.FLASHLIGHT','de.lotum.whatsinthefoto.us.permission.C2D_MESSAGE','com.android.browser.permission.WRITE_HISTORY_BOOKMARKS','android.permission.DISABLE_KEYGUARD','com.outfit7.talkingnewsfree.permission.C2D_MESSAGE','com.skout.android.permission.C2D_MESSAGE','com.outlook.Z7.permission.BIND_SERVICE','android.permission.WRITE_SECURE_SETTINGS','com.android.ContactWidget.permission.READ_SETTINGS','android.permission.WRITE_CONTACTS','com.googleapps.ru.permission.C2D_MESSAGE','android.permission.AUTHENTICATE_ACCOUNTS','com.google.android.gm.permission.READ_GMAIL','android.permission.READ_SYNC_STATS','me.everything.launcher.permission.C2D_MESSAGE','android.permission.MANAGE_DOCUMENTS','android.permission.READ_EXTERNAL_STORAGE','com.tophatter.permission.UA_DATA','android.permission.WRITE_CALENDAR','android.permission.SET_WALLPAPER_HINTS','com.trustlook.antivirus.permission.C2D_MESSAGE','com.nytimes.android.permission.C2D_MESSAGE','com.randomlogicgames.guesstheword.permission.C2D_MESSAGE','com.lge.launcher.permission.INSTALL_SHORTCUT','android.permission.SET_PREFERRED_APPLICATIONS','android.permission.ANSWER_PHONE','com.lge.launcher.permission.READ_SETTINGS','com.sonyericsson.home.permission.BROADCAST_BADGE','me.everything.launcher.permission.WRITE_SETTINGS','ru.android.apps.permission.C2D_MESSAGE','com.perblue.bob.permission.C2D_MESSAGE','jp.co.winlight.rpg_eko_gpfr.permission.C2D_MESSAGE','fbreader.permission.LIBRARY','com.talkray.client.permission.MAPS_RECEIVE','com.tripit.permission.C2D_MESSAGE','com.tmob.teknosa.permission.MAPS_RECEIVE','android.permission.WRITE','com.pcsalt.nearby.permission.MAPS_RECEIVE','fbreader.permission.CONFIG','android.permission.CALL_PRIVILEGED','com.pnixegames.gunzombieHellGateAmazon.permission.C2D_MESSAGE','jp.gocro.smartnews.android.permission.C2D_MESSAGE','com.rarewire.forever21.permission.MAPS_RECEIVE','android.permission.STATUS_BAR','android.permission.WRITE_SYNC_SETTINGS','com.android.launcher.permission.UNINSTALL_SHORTCUT','com.fede.launcher.permission.READ_SETTINGS','com.android.launcher2.permission.INSTALL_SHORTCUT','android.permission.WRITE_SOCIAL_STREAM','android.permission.SYSTEM_ALERT_WINDOW','TRUE','com.mvine.q.permission.MAPS_RECEIVE','android.permission.ACCESS_PHONE_STATE','org.mozilla.firefox.permissions.PASSWORD_PROVIDER','android.permission.READ_PROFILE','android.permission.GET_PACKAGE_SIZE','me.everything.launcher.permission.READ_SETTINGS','com.usatoday.android.news.permission.UA_DATA','com.dsi.ant.permission.ANT_ADMIN','android.permission.INTERACT_ACROSS_USERS','com.protrade.sportacular.permission.C2D_MESSAGE','android.webkit.permission.PLUGIN','com.samsung.accessory.permission.ACCESSORY_FILE_TRANSFER','com.android.browser.permission.READ_HISTORY_BOOKMARKS','com.motorola.launcher.permission.INSTALL_SHORTCUT','android.permission.INTERNET','org.cocos2dx.hellocpp.permission.C2D_MESSAGE','com.moovit.permission.C2D_MESSAGE','android.permission.CHANGE_CONFIGURATION','android.permission.WRITE_MEDIA_STORAGE','com.sonypicturestelevision.sportsjeopardy.permission.C2D_MESSAGE','android.permission.APPWIDGET_LIST','com.tencent.mm.wear.message','com.zzkko.permission.C2D_MESSAGE','quess.song.music.pop.quiz.permission.C2D_MESSAGE','android.permission.ACCESS_LOCATION_EXTRA_COMMANDS','com.zumobi.msnbc.permission.UA_DATA','com.sec.android.provider.badge.permission.WRITE','com.tgs.systems.lmt.permission.MAPS_RECEIVE','fbreader.permission.SYNC','android.permission.ACCESS_SUPERUSER','com.android.alarm.permission.SET_ALARM','com.teslacoilsw.launcher.permission.WRITE_SETTINGS','com.sec.android.provider.badge.permission.READ','android.permission.READ_LOGS','com.tmob.teknosa.permission.C2D_MESSAGE','com.zappos.android.permission.MAPS_RECEIVE','com.nexonm.monstersquad.permission.C2D_MESSAGE','dev|qa','com.tophatter.permission.C2D_MESSAGE','android.permission.READ_SETTINGS','android.permission.RECEIVE_SENDTO','com.wonder.permission.C2D_MESSAGE','android.permission.ACCESS_COARSE_LOCATION','de.defim.apk.permission.LICENSE','android.permission.UNINSTALL_PACKAGES','android.permission.MOUNT_UNMOUNT_FILESYSTEMS','android.permission.WRITE_INTERNAL_STORAGE','com.socialquantum.acityint.permission.C2D_MESSAGE','android.permission.CALL_PHONE','com.dsi.ant.permission.ANT','com.talkray.client.permission.C2D_MESSAGE','com.gteam.xxxES.permission.C2D_MESSAGE','android.permission.READ_PHtwo_STATE','com.xyrality.lkclient.permission.C2D_MESSAGE','com.mozillaonline.permission.ACCESS_DOWNLOAD_MANAGER','com.tencent.mm.plugin.permission.GOOGLE_AUTH','com.wanelo.android.permission.C2D_MESSAGE','de.Fitness.permission.C2D_MESSAGE','android.permission.RESTART_PACKAGES','com.orbitz.permission.C2D_MESSAGE','com.samsung.wmanager.APP','android.permission.ACCESS_LOCATION','android.permission.ACCESS_WIMAX_STATE','android.permission.DOWNLOAD_WITHOUT_NOTIFICATION','android.permission.ACCESS_GPS','android.permission.GET_TASKS','com.wantu.activity.permission.C2D_MESSAGE','android.permission.WRITE_SETTINGS','android.permission.READ_FRAME_BUFFER','com.android.launcher.permission.READ_SETTINGS','android.permission.KILL_BACKGROUND_PROCESSES','com.tinyco.familyguy.permission.C2D_MESSAGE','android.permission.ACTION_IMAGE_CAPTURE','android.permission.PERMISSION_NAME','android.permission.ACCESS_DOWNLOAD_MANAGER','android.permission.READ_SYNC_SETTINGS','com.urbanspoon.permission.C2D_MESSAGE','android.permission.SEND_SMS','com.paktor.permission.C2D_MESSAGE','android.permission.SET_WALLPAPER','com.myapp.diybedroomideas.permission.C2D_MESSAGE','com.android.vending.CHECK_LICENSE','android.permission.USE_CREDENTIALS','android.permission.RECORD_VIDEO','android.permission.BLUETOOTH_ADMIN','android.permission.DEVICE_POWER','android.permission.BROADCAST_WAP_PUSH','com.google.android.providers.gsf.permission.READ_GSERVICES','android.permission.RECEIVE_USER_PRESENT','com.wMicrosoftAccess2010BeginnerLevel1Tutorial.permission.C2D_MESSAGE','com.screen.locker.themes.permission.C2D_MESSAGE','18','android.permission.BLUETOOTH','android.permission.THEME_PROVIDER_ACCESS','sts.al.permission.C2D_MESSAGE','com.tripadvisor.tripadvisor.permission.C2D_MESSAGE','com.priceline.android.negotiator.permission.MAPS_RECEIVE','mobi.ifunny.permission.C2D_MESSAGE','com.savingstar.SavingStar.permission.C2D_MESSAGE','android.permission.READ_PHONE_STATE','android.permission.RECEIVE_BOOT_COMPLETED','com.rootuninstaller.QUICK_BAR','com.google.android.gm.permission.READ_CONTENT_PROVIDER','com.tencent.mm.plugin.permission.WRITE','com.outlook.Z7.permission.ACCESS_EVENTS','com.overstock.permission.C2D_MESSAGE','android.permission.NFC','dk.boggie.madplan.android.permission.C2D_MESSAGE','com.sonyericsson.extras.liveware.aef.EXTENSION_PERMISSION','com.htc.launcher.permission.READ_SETTINGS','com.amazon.device.messaging.permission.RECEIVE','android.permission.CAMERA','com.teslacoilsw.launcher.permission.READ_SETTINGS','android.permission.ACCESS_FINE_LOCATION','com.zulily.android.permission.C2D_MESSAGE','com.viber.voip.permission.C2D_MESSAGE','android.permission.WRITE_CALL_LOG','android.permission.WRITE_OWNER_DATA','com.motorola.launcher.permission.READ_SETTINGS','com.android.email.permission.READ_ATTACHMENT','com.tencent.mm.ext.permission.READ','com.tencent.mm.plugin.permission.SEND','com.sillens.shapeupclub.permission.C2D_MESSAGE','com.netmarble.mherosgb.permission.C2D_MESSAGE','com.outlook.Z7.permission.ACCESS_PROVIDER','com.painless.pc.permission.CONTROL_PLUGIN','com.musixmatch.android.lyrify.permission.C2D_MESSAGE','seeMuscatAndroidApp.seeMuscatAndroipApp.permission.C2D_MESSAGE','android.permission.BROADCAST_STICKY','com.MySmartPrice.MySmartPrice.permission.C2D_MESSAGE','android.permission.INTERNAL_SYSTEM_WINDOW','huawei.android.permission.HW_SIGNATURE_OR_SYSTEM','com.android.vending.INSTALL_REFERRER','com.zynga.scramble.permission.C2D_MESSAGE','com.rhythmnewmedia.android.e.permission.C2D_MESSAGE','com.perfectgame.adventure.permission.C2D_MESSAGE','android.permission.DUMP','com.software.application.permission.C2D_MESSAGE','FALSE','com.vng.g6.a.zombie.permission.C2D_MESSAGE','com.zappos.android.permission.C2D_MESSAGE','com.urbanspoon.permission.MAPS_RECEIVE','com.motorola.dlauncher.permission.READ_SETTINGS','android.permission.ACCESS_COARSE','com.sololearn.cplusplus.permission.C2D_MESSAGE','com.anddoes.launcher.permission.UPDATE_COUNT','android.permission.RECORD_AUDIO','android.permission.ACCESS_NETWORK_STATE','android.permission.CLEAR_APP_CACHE','com.qihoo.security.permission.C2D_MESSAGE','com.smule.songify.permission.C2D_MESSAGE','com.snipsnap.snipsnapapp.permission.C2D_MESSAGE','com.google.android.providers.gmail.permission.READ_GMAIL','android.permission.BIND_APPWIDGET','android.permission.VIBRATE','com.sololearn.exceltrial.permission.C2D_MESSAGE','com.qihoo.security.PERMISSION','android.permission.INSTALL_LOCATION_PROVIDER','com.anddoes.launcher.permission.READ_SETTINGS','com.sabre.tripcase.permission.C2D_MESSAGE','de.lotumapps.vibes.permission.C2D_MESSAGE','android.permission.WRITE_SMS','miyowa.android.microsoft.wlm.permission.C2D_MESSAGE','net.dinglisch.android.tasker.PERMISSION_RUN_TASKS','com.smule.autorap.permission.C2D_MESSAGE','android.permission.SET_ORIENTATION','com.trello.permission.C2D_MESSAGE','android.permission.REORDER_TASKS','com.speaktoit.assistant.permission.C2D_MESSAGE','com.apps.android.permission.C2D_MESSAGE','com.trendmicro.dr.booster.permission.C2D_MESSAGE','android.permission.EXPAND_STATUS_BAR','com.tgs.systems.lmtdeal.permission.C2D_MESSAGE','com.motorola.dlauncher.permission.INSTALL_SHORTCUT','de.lotumapps.truefalsequiz.us.permission.C2D_MESSAGE','com.htc.launcher.permission.UPDATE_SHORTCUT','com.oovoo.permission.C2D_MESSAGE','com.skimble.workouts.permission.C2D_MESSAGE','android.permission.READ_SOCIAL_STREAM','com.rd.fhmdiy.permission.C2D_MESSAGE','com.zumobi.msnbc.permission.RECEIVE_ADM_MESSAGE','android.permission.CHANGE_WIFI_STATE','com.ted.android.permission.C2D_MESSAGE','com.google.android.gms.permission.ACTIVITY_RECOGNITION','com.paktor.fragments.permission.MAPS_RECEIVE','com.samsung.accessory.permission.ACCESSORY_FRAMEWORK','android.permission.READ_CONTACTS','android.permission.WRITE_EXTERNAL_STORAGE','android.permission.READ_CALL_LOG','gl.fx.galaxycontrol.permission.C2D_MESSAGE','com.sunway.sunwaylifestyle.permission.C2D_MESSAGE','android.permission.READ_SMS','android.permission.ACCESS_WIFI_STATE','my_app_package.permission.C2D_MESSAGE','guidecentral.howto.diy.crafts.permission.C2D_MESSAGE','com.android.launcher.permission.WRITE_SETTINGS','com.google.android.launcher.permission.READ_SETTINGS','pl.idreams.plugins.permission.C2D_MESSAGE','com.android.permission.REORDER_TASKS','com.totallyproducts.SexBestTriviaGameIWin.permission.C2D_MESSAGE','com.rebelvox.voxer.permission.C2D_MESSAGE','com.unifiedapps.businesscardmaker.permission.C2D_MESSAGE','org.adw.launcher.permission.READ_SETTINGS','in.justcooking.dictionary.permission.C2D_MESSAGE','android.permission.CHANGE_NETWORK_STATE','android.permission.READ_INTERNAL_STORAGE','android.permission.ACCESS_MOCK_LOCATION','com.samsung.android.providers.context.permission.WRITE_USE_APP_FEATURE_SURVEY','android.permission.BACKUP','android.permission.CHANGE_WIMAX_STATE','com.tripadvisor.android.lib.tamobile.permission.MAPS_RECEIVE','de.hafas.android.db.permission.MAPS_RECEIVE','com.google.android.gallery3d.permission.GALLERY_PROVIDER','com.tencent.mm.location.permission.SEND_VIEW','android.permission.NETWORK','net.daum.android.air.permission.AOM_MESSAGE','com.williamsinteractive.goldfish.permission.C2D_MESSAGE','android.permission.RECEIVE_MMS','com.yellowpages.android.ypmobile.permission.MAPS_RECEIVE','com.google.android.c2dm.permission.REGISTER','android.permission.ACCESS_COARSE_UPDATES','android.permission.MANAGE_USB','your.CouponFinder.CouponFinder.permission.C2D_MESSAGE','com.rarewire.forever21.permission.C2D_MESSAGE','android.permission.MEDIA_CONTENT_CONTROL','com.usatoday.android.news.permission.C2D_MESSAGE','com.taggedapp.permission.C2D_MESSAGE','android.permission.CHANGE_WIFI_MULTICAST_STATE','android.permission.WRITE_APN_SETTINGS','com.triposo.droidguide.world.permission.C2D_MESSAGE','com.parrot.flowerpower.android.gcm.permission.C2D_MESSAGE','com.skt.aom.permission.AOM_RECEIVE','org.lds.ldssa.permission.C2D_MESSAGE','com.unearby.sayhi.permission.C2D_MESSAGE','com.tfs.consumer.permission.MAPS_RECEIVE','com.nttsolmare.game.android.msp.permission.C2D_MESSAGE','com.wb.wwe.brawler2014.permission.C2D_MESSAGE','android.permission.MANAGE_ACCOUNTS','com.outsmart.GopherLaunch.permission.C2D_MESSAGE','com.tencent.mm.plugin.permission.READ','com.scoutmob.ile.permission.C2D_MESSAGE','android.permission.FINE_LOCATION','com.omgpop.dstfree.permission.C2D_MESSAGE']


def extract_permission(file):
    try:
     root = ET.parse(file).getroot()
    except:
        print("error in file:%s" %(file))
        return[]
    else:
        root = ET.parse(file).getroot()
    permissions=[]
    permission=[]
    permission+= root.findall("uses-permission")
    #permission+= root.findall("uses-feature")
    #permission+= root.findall("permission")
    #for instance in root.findall('application/receiver/intent-filter/action'):
     #permission+= [instance]
    for perm in permission :
     for att in perm.attrib:
        permissions += [ perm.attrib[att]] 
    return (sorted(permissions)) 

def permission_data(path):
 permission_array=[]
 app_permissions={}
 with os.scandir(path) as entries:
    for entry in entries:
     if(os.path.isdir(entry)):
      for f_name in os.scandir(entry):
       if f_name.name.endswith('.xml'):
        permission_for_app=extract_permission(f_name)
        permission_array+=(permission_for_app)
        app_permissions[entry.name] = permission_for_app
 return (features,app_permissions)


def write_to_csv(permission,appname):
    with open(filename, 'a', newline="") as file:
          csvwriter = csv.writer(file)
          csvwriter.writerow([appname]+ permission)
          file.close()

def boolean_array(permission_array,permissions):
    vector= [0]*len(permission_array)
    for permission in permissions:
        if permission in permission_array:
         vector[permission_array.index(permission)]+=1
    return(vector)


path = '/Users/teja/Downloads/additional_data_set'
filename = '/Users/teja/Downloads/data_sets/additional_data_set_features_1.csv'
permission_array,app_permissions=permission_data(path)
print (len(permission_array))
write_to_csv(permission_array,"app_name")
for app_name in app_permissions:
    permissions=app_permissions[app_name]
    write_to_csv(boolean_array(permission_array,permissions),app_name)